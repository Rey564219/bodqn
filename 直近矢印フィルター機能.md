# 📍 直近矢印ベースの取引停止機能

## 🎯 新機能: 右から矢印を見た負けベース停止

従来の連続負け（時間ベース）に加えて、**右から矢印を見て直近10回中6回以上負けたら2分間トレード停止**する機能を追加しました。

### ⚙️ 設定
```python
RECENT_CHECK_COUNT = 10           # 右から見て何回分の矢印を見るか
RECENT_LOSS_THRESHOLD = 6         # そのうち何回以上負けならブロックするか  
RECENT_BLOCK_SECONDS = 120        # 条件該当時にトレードを停止する秒数（2分）
```

### 🔄 動作の流れ

1. **取引結果を記録**: 勝ち/負けが `recent_trade_outcomes` deque に追加される
2. **10回溜まったら評価**: 右から10回分の結果を確認
3. **6回以上負けたら停止**: 2分間（120秒）すべてのトレードを停止
4. **2分経過で再開**: 自動的にトレード再開

### 📊 表示例

#### 起動メッセージ
```
🎯 直近矢印フィルター設定:
  - 確認する矢印数: 10回
  - 負け閾値: 6回以上
  - ブロック時間: 120秒（2分）
```

#### 停止時のメッセージ
```
[PAUSE] 直近10回で7回の負け => トレードを120秒間停止します（14:35:21まで）
[⏸️ PAUSE] High - 直近の負けによりトレード停止中 (残り95秒, 14:35:21まで)
```

#### 定期状態表示
```
[🎯 RECENT ARROWS] 直近10/10回の結果
  - 負け: 7回 🚫ブロック対象
  - 矢印: ❌✅❌❌✅❌❌❌✅❌ (右から左へ)
  - ⏸️ トレード停止中: あと95秒
```

### 🔄 従来機能との関係

- **従来の連敗フィルター**: 時間ベース（直近5分間で同方向3連続負け → 3分間その方向のみブロック）
- **新しい矢印フィルター**: 回数ベース（直近10回で6回以上負け → 2分間全トレードブロック）

**両方独立して動作**し、どちらかの条件に該当すればブロックされます。

### 🛠️ 手動記録との連携

既存の手動記録機能と完全連携：

```python
# 負けを記録すると自動的にrecent_trade_outcomesにも追加される
add_loss_to_history(loss_history, 'High', 150.123)

# 勝ちの場合は手動記録不要（自動検出時のみ記録）
```

### ⚡ 特徴

1. **タイムリーな制御**: 時間に関係なく、純粋に結果ベースで判定
2. **全方向停止**: High/Lowの区別なく、すべてのトレードを停止
3. **短時間ブロック**: 2分間という短期間で迅速に復帰
4. **視覚的確認**: 矢印表示でパフォーマンスが一目瞭然

### 📋 ログファイル

CSVログには新しい停止理由が追加されます：
```
reason列: "recent_losses_pause_95s" (95秒間停止中)
```

この機能により、連続して調子が悪い時により迅速にトレードを一時停止し、資金を保護できます。